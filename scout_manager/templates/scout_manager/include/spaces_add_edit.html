{% load staticfiles %}
{% csrf_token %}

<div class="alert hidden" role="alert" id="pub_error"></div>

<div class="clearfix sticky" style="margin-bottom:1em;">

    <h2 class="pull-left">
        <span class="fa-stack fa-lg" style="position:relative; margin-top:-3px;">
            <i class="fa fa-circle fa-stack-2x"></i>
            {% if spot.app_type == "food" %}
            <i class="fa fa-cutlery fa-stack-1x fa-inverse"></i>
            {% elif spot.app_type == "study" %}
            <i class="fa fa-graduation-cap fa-stack-1x fa-inverse"></i>
            {% elif spot.app_type == "tech" %}
            <i class="fa fa-laptop fa-stack-1x fa-inverse"></i>
            {% else %}
            <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
            {% endif %}
        </span>
        {% if spot.name %}{{ spot.name }}{% else %}Add New Space{% endif %}
    </h2>

    <div class="pull-right">

        {% if spot.name %}
            {% if spot.is_hidden %}
            <div class="scout-draft">
                <span class="text-muted"></span>&nbsp;&nbsp;&nbsp;
                <input id="submit_spot" type="button" class="btn btn-primary" value="Save Draft" style="display:inline-block;"></input>
            </div>
            {% else %}
            <div class="scout-published">
                <span class="text-muted"></span>&nbsp;&nbsp;&nbsp;
                <input id="submit_spot" type="button" class="btn btn-primary" value="Publish Changes" style="display:inline-block;"></input>
            </div>
            {% endif %}
        {% else %}
        <div class="scout-create">
            <span class="text-danger">Note: All required fields must be filled before you can create.</span>&nbsp;&nbsp;&nbsp;
            <input id="submit_spot" type="button" class="btn btn-primary" value="Create Space" style="display:inline-block;"></input>
        </div>
        {% endif %}

    </div>

</div>

<div class="row">

    <div class="col-md-8">

        <h3 class="">General Info</h3>

        <div class="form-group">
            <label for="space-name" class="control-label">Name:</label>
            <input type="text" class="form-control" name="name" id="space-name" value="{% if spot.name %}{{ spot.name }}{% endif %}" required data-error="Please provide a name for this spot." />
            <div class="help-block with-errors"></div>

            <input type="hidden" name="id" value="{{ spot.spot_id }}" />
            <input type="hidden" name="etag" value="{{ spot.etag }}" />
        </div>

        <fieldset style="margin-top:1em;" class="radio-group required" id="app_type_radio">
            <legend class="control-label">App Type: {{ spot.app_type }}</legend>

            {% if spot.name %}
                {% if spot.app_type == "food" %}
                <input type="hidden" name="extended_info:app_type" value="food" checked />
                {% elif spot.app_type == "study" %}
                <input type="hidden" checked />
                {% elif spot.app_type == "tech" %}
                <input type="hidden" name="extended_info:app_type" value="tech" checked />
                {% endif %}
                <p class="help-block">Note: Please contact ADMINS if you need to change this space's app_type</p>
            {% else %}
            <div id="add_new_extended_info" class="well mgr-set-app-type">
                <div class="radio">
                    <label><input type="radio" name="extended_info:app_type" value="food">Food</label>
                </div>
                <div class="radio">
                    <label><input id="study_radio" type="radio" value="study">Study</label>
                </div>
                <div class="radio">
                    <label><input type="radio" name="extended_info:app_type" value="tech">Tech</label>
                </div>
            </div>
            <div class="help-block with-errors">Please select an app_type.</div>
            {% endif %}

        </fieldset>

        {% if spot.name %}
        <div class="form-group">
            <label for="space-description">Space Description: <span class="label label-info">F</span></label>
            <textarea name="extended_info:description" rows="4" class="form-control" id="description" type="text">{% if spot.description %}{{spot.description}}{% endif %}</textarea>
            <p class="help-block">Note: description of the space</p>
        </div>
        {% endif %}

    </div>
    <div class="col-md-4">

        {% if spot.name %}
        <h3 class="">Publish</h3>
        <div class="form-group well">
            <div>
                <label>Status: <span style="font-weight:normal;">{% if spot.is_hidden %}DRAFT{% else %}PUBLISHED{% endif %}</span></label>
            </div>
            <div class="mgr-dataset-actions">
                <div class="checkbox hidden">
                    <label><input type="checkbox" name="extended_info:is_hidden" {% if spot.is_hidden %} checked{% endif %} value="true"></input>Is Hidden?</label>
                </div>
                {% if spot.is_hidden %}
                <div class="scout-draft-actions">
                    <button type="button" id="toggle_is_hidden" class="btn btn-default btn-sm"><i class="fa fa-eye"></i> <span>Publish</span></button>
                    <div class="help-block"></div>
                </div>
                {% else %}
                <div class="scout-published-actions">
                    <button type="button" id="toggle_is_hidden" class="btn btn-default btn-sm"><i class="fa fa-eye-slash"></i> <span>Unpublish</span></button>
                    {% if not spot.app_type == "tech" %}
                    <a class="btn btn-default btn-sm" href="/{{spot.campus}}/{{spot.app_type}}/{{ spot.spot_id }}" target="_blank"><i class="fa fa-chrome"></i> <span>View in Scout</span></a>
                    {% endif %}
                    <div class="help-block">Note: Unpublishing a spot will remove it from all client apps and set it to Draft.</div>
                </div>
                {% endif %}

            </div>
        </div>
        {% else %}
        <div class="checkbox hidden">
            <label><input type="checkbox" name="extended_info:is_hidden" checked value="true"></input>Is Hidden?</label>
        </div>
        {% endif %}


        <h3 class="">Admin Group</h3>
        <div class="form-group">
            <label for="owner" class="control-label">Owner/Admin Group:</label>
            <input class="form-control" id="owner" name="extended_info:owner" type="text" value="{% if spot.owner %}{{ spot.owner }}{% endif %}" required data-error="An owner group must be provided.">
            <div class="help-block with-errors"></div>
        </div>
        <p class="help-block">Note: Use the <a href="https://groups.uw.edu/" target="_blank">UW Groups</a> service to create or manage your groups.</p>


        {% if spot.name %}
        <h3 class="">Contact Info</h3>

        <div class="form-group">
            <label for="manager-name">Manager Name:</label>
            <input class="form-control" id="manager-name" name="manager" type="text" value="{% if spot.manager %}{{ spot.manager }}{% endif %}">
        </div>

        <div class="form-group">
            <label for="email" class="control-label">Email:</label>
            <input class="form-control" id="email" name="extended_info:s_email" type="email" value="{% if spot.email %}{{ spot.email }}{% endif %}" data-error="must be a valid email format">
            <div class="help-block with-errors"></div>
        </div>

        <div class="form-group">
            <label for="phone" class="control-label">Phone: <span class="label label-info">F</span></label>
            <input class="form-control" id="phone" name="extended_info:s_phone" type="tel" pattern="^\d{10}$" value="{% if spot.phone %}{{ spot.phone }}{% endif %}" data-error="please provide 10 digit phone number no dashses">
            <div class="help-block with-errors"></div>
        </div>

        {% endif %}

    </div>

</div>


{% if spot.app_type == "food" %}
    {% include "scout_manager/include/extend_food.html" %}
{% elif spot.app_type == "study" %}
    {% include "scout_manager/include/extend_study.html" %}
{% elif spot.app_type == "tech" %}
    <fieldset class="checkbox-group {% if spot.name %}required{% endif %}">
        <legend class="control-label">Spot types</legend>
        <div class="well" id="tech_spot_types">
            <div class="checkbox">
                <label><input type="checkbox" name="type" {% for type in spot.spot_types %}{% if "checkout" in type.name %} checked {% endif %}{% endfor %}  value="checkout">Equipment Checkout</label>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" name="type" {% for type in spot.spot_types %}{% if "conference" in type.name %} checked {% endif %}{% endfor %}  value="conference">Conference Room</label>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" name="type" {% for type in spot.spot_types %}{% if "maker_space" in type.name %} checked {% endif %}{% endfor %} value="maker_space">Maker Space</label>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" name="type" {% for type in spot.spot_types %}{% if "studio" in type.name %} checked {% endif %}{% endfor %}  value="studio">Production Studio</label>
            </div>
        </div>
        <div class="help-block with-errors">Please select at least 1 spot type.</div>
    </fieldset>

{% endif %}

{% if spot.name %}
    <!-- include the images form -->
    {% include "scout_manager/include/form_images.html" %}
{% endif %}


{% include "scout_manager/include/form_location.html" %}


{% if spot.name %}

    <hr/>

    <h3>Current Alert</h3> {# we need to set has_alert too to show it #}

    <div class="checkbox">
        <label><input name="extended_info:has_alert" type="checkbox" value="true" {% if spot.has_alert %}checked{% endif %}>Alert Enabled</label>
    </div>

    <div class="form-group">
        <label for="alert-notes">Post this Alert message:</label>
        <textarea class="form-control" rows="4" id="alert-notes" name="extended_info:alert_notes">{% if spot.alert_notes %}{{ spot.alert_notes }}{% endif %}</textarea>
        <p class="help-block">Note: Alert message will only be displayed to clients IF the "Alert Enabled" checkbox is checked.</p>
    </div>

    <!-- include the hour and access form -->
    {% include "scout_manager/include/form_hours.html" %}

    <hr/>

    <h3 class="">DELETE</h3>
    <div class="form-group well">
        <div>
            <label>Delete this space?</label>
        </div>
        <div class="mgr-dataset-actions">
            <button id="spot_delete" type="button" class="btn btn-danger btn-sm scope btn-delete"><i class="fa fa-trash"></i> <span>Delete</span></button>
            <div class="help-block">Note: This action cannot be undone!</div>
        </div>
    </div>

{% endif %}

<!-- FOR NOW: items for tech spaces -->
{% if spot.name and spot.app_type == "tech" %}

    <hr/>

    <h3>Item(s)</h3>

    <p><a class="" href="/manager/items/add/">Add New Item to this space</a></p>
    <p>Total: <span class="">{{ spot.items|length }}</span></p>

    <div style="margin-top: 15px;" class="table-responsive">

        {% if spot.items|length > 0 %}
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Sub Category (type)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in spot.items %}
                <tr>
                    <td><a href="/manager/items/{{ item.item_id }}/">{{ item.item_id }}</a></td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.subcategory }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        There are no items in this space!
        {% endif %}
    </div>

{% endif %}
